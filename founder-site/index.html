<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>何铖博・筑梦OS</title>
    
    <!-- Cache Buster for CSS -->
    <script>
        document.write('<link rel="stylesheet" href="style.css?v=' + new Date().getTime() + '">');
    </script>
    <noscript><link rel="stylesheet" href="style.css"></noscript>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;700&family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- MediaPipe for Gesture Recognition -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
</head>
<body>

    <!-- 1. Narrative Intro Layer (Gesture Edition) -->
    <div id="intro-layer">
        <div class="intro-content">
            <div class="intro-title">筑梦OS · 身份识别</div>
            
            <!-- Camera/Gesture Area -->
            <div class="gesture-container neon-border-flow">
                <!-- iOS Fix: Do not use display:none, use opacity:0 -->
                <video id="input_video" style="position:absolute; top:0; left:0; width:100%; height:100%; object-fit:cover; opacity:0; pointer-events:none;" playsinline muted autoplay></video>
                <canvas id="output_canvas" width="320" height="240"></canvas>
                
                <!-- Scanning Overlay -->
                <div class="scan-line"></div>
                <div class="scan-overlay">
                    <div class="corner c-tl"></div>
                    <div class="corner c-tr"></div>
                    <div class="corner c-bl"></div>
                    <div class="corner c-br"></div>
                </div>
                
                <!-- Loading/Status -->
                <div id="gesture-status">
                    <span class="blink">●</span> 初始化视觉核心...
                </div>
            </div>

            <div class="gesture-hint">
                <div class="hint-icon">👍</div>
                <div class="hint-text">请对着摄像头<br><strong>竖起大拇指</strong><br>解锁系统</div>
            </div>

            <!-- Fallback Manual Button -->
            <button id="btn-manual-start" class="btn-text-only">
                [ 摄像头不可用？点击手动进入 ]
            </button>
        </div>
    </div>

    <!-- Mobile Menu Button -->
    <button id="mobile-menu-btn" style="display: none;">☰</button>

    <!-- 2. Main App Container -->
    <div id="app-container">
        
        <!-- Sidebar Navigation -->
        <aside>
            <div class="logo-area">
                <div class="logo-text">何铖博・筑梦</div>
                <div class="logo-sub">Founder Growth OS v2.0</div>
            </div>

            <ul class="nav-menu">
                <li class="nav-item active" data-tab="daily">
                    <div class="neon-bar"></div>
                    <span>📝 今日剪辑复盘</span>
                </li>
                <li class="nav-item" data-tab="meeting">
                    <span>📋 会议记录</span>
                </li>
                <li class="nav-item" data-tab="skills">
                    <span>🎯 技能提升计划</span>
                </li>
                <li class="nav-item" data-tab="growth">
                    <span>📈 成长轨迹看板</span>
                </li>
                <li class="nav-item" data-tab="history">
                    <span>📜 往日历程</span>
                </li>
                <li class="nav-item" data-tab="profile">
                    <span>👤 个人中心</span>
                </li>
            </ul>

            <!-- Total Progress -->
            <div class="total-progress-container">
                <div class="progress-label">
                    <span>总筑梦进度</span>
                    <span id="lbl-total-progress">0%</span>
                </div>
                <div class="progress-track">
                    <div class="progress-fill" id="bar-total-progress"></div>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main>
            <!-- Profile Header -->
            <div class="profile-header">
                <div class="profile-info">
                    <h2 class="text-white">Hello, <span class="text-orange">何铖博</span></h2>
                    <div class="profile-meta">
                        <span class="font-mono text-blue">已筑梦 <span id="days-count">0</span> 天</span>
                        <span class="contact-pill" title="工作沟通专用">📞 15992677659</span>
                    </div>
                </div>
                
                <!-- Date Selector (Mock) -->
                <div class="tech-card" style="padding: 8px 16px; font-family: monospace; cursor: pointer;">
                    📅 <span id="current-date-display">2025-11-30</span> ▼
                </div>
            </div>

            <!-- Dynamic Dashboard Grid -->
            <div id="dashboard-content" class="dashboard-grid">
                <!-- Left Col: SOP & Reflection -->
                <div class="section-col">
                    
                    <!-- 1. Results & Mindmap (SOP Board) -->
                    <div class="tech-card" style="z-index: 6;">
                        <div class="card-title">
                            <span>🧠 核心SOP战术板</span>
                            <span class="card-tag">SOP Archive</span>
                        </div>
                        
                        <!-- Split Layout for Mindmap -->
                        <div class="mindmap-layout" style="display: flex; gap: 15px; height: 500px;"> <!-- Increased height -->
                            <!-- Left: Active Preview -->
                            <div class="mindmap-main" style="flex: 2; display: flex; flex-direction: column;">
                                <div id="mindmap-preview" style="flex: 1; border: 1px solid var(--border-glass); border-radius: 4px; overflow: hidden; position: relative;">
                                    <!-- JS Injected Iframe -->
                                    <button class="btn-expand-map" style="position:absolute; bottom:10px; right:10px; top:auto; left:auto; transform:none;">🔍 全息展开</button>
                                </div>
                                <div id="mindmap-info" style="margin-top: 8px; font-size: 0.8rem; color: var(--accent-blue);"></div>
                            </div>

                            <!-- Right: Playlist --> 
                            <div class="mindmap-list-container" style="flex: 1; border-left: 1px solid var(--border-glass); padding-left: 15px; overflow-y: auto;">
                                <div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 8px;">SOP 档案库</div>
                                <ul class="mindmap-list" id="mindmap-list">
                                    <!-- JS Injected items -->
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- 2. Daily Reflection -->
                    <div class="tech-card">
                        <div class="card-title">
                            <span>💡 每日总结</span>
                            <span class="card-tag">Reflect v1.2</span>
                        </div>
                        <div class="result-text" id="daily-reflection" contenteditable="true" style="white-space: pre-line;">
                            <!-- JS Injected -->
                        </div>
                        <input type="text" placeholder="输入明日优化方向..." style="width:100%; background:transparent; border:none; border-bottom:1px solid #333; color:#fff; padding:5px;">
                    </div>

                </div>

                <!-- Right Col: Results, Meeting, Calendar -->
                <div class="section-col">
                    
                    <!-- 1. Results -->
                    <div class="tech-card" style="border-top: 2px solid var(--accent-orange);">
                        <div class="card-title">
                            <span class="text-orange">🚀 今日实干成果</span>
                        </div>
                        <div class="result-text" id="daily-results" style="white-space: pre-line;">
                            <!-- JS Injected -->
                        </div>
                    </div>

                    <!-- 2. Meeting Minutes (New) -->
                    <div class="tech-card">
                        <div class="card-title">
                            <span>📋 会议记录</span>
                            <span class="card-tag">Sync</span>
                        </div>
                        <div class="result-text" id="meeting-minutes" style="white-space: pre-line; min-height: 100px;">
                            <!-- JS Injected -->
                            暂无记录
                        </div>
                    </div>

                    <!-- 3. Attendance Calendar -->
                    <div class="tech-card">
                        <div class="card-title">
                            <span>📅 筑梦出勤表</span>
                            <span class="card-tag" id="cal-month-label">11月</span>
                        </div>
                        <div class="calendar-grid" id="attendance-calendar">
                            <!-- JS Injected Days -->
                        </div>
                        <div style="font-size: 0.7rem; color: var(--text-muted); margin-top: 10px; text-align: center;">
                            *每月 1, 2, 17, 18 号休息充电
                        </div>
                    </div>

                </div>
            </div>

            <!-- History View (Hidden by default) -->
            <div id="history-view" class="dashboard-grid" style="display: none;">
                <!-- Left: Timeline List -->
                <div class="section-col">
                    <h3 class="text-white" style="margin-bottom: 10px;">⏳ 筑梦时间轴</h3>
                    <div id="history-timeline" style="display: flex; flex-direction: column; gap: 15px;">
                        <!-- JS Injected -->
                    </div>
                </div>

                <!-- Right: Detail Preview -->
                <div class="section-col">
                    <div class="tech-card" style="position: sticky; top: 20px; height: fit-content;">
                        <div class="card-title">
                            <span class="text-orange">🎞️ 历史回溯</span>
                            <span class="card-tag" id="hist-date-tag">Select a log</span>
                        </div>
                        
                        <!-- Preview Content -->
                        <div id="hist-preview-content" style="opacity: 0.5; text-align: center; padding: 20px;">
                            请在左侧选择一天查看详情
                        </div>
                        
                        <!-- Dynamic Content Container (Hidden initially) -->
                        <div id="hist-detail-box" style="display: none;">
                            <div class="mindmap-thumb" id="hist-mindmap-thumb" style="height: 200px; margin-bottom: 15px;">
                                <!-- Img here -->
                                <button class="btn-expand-map" id="hist-btn-expand">🔍 查看脑图</button>
                            </div>
                            <div class="result-text" id="hist-summary"></div>
                            <div style="font-size: 0.8rem; color: var(--text-muted); border-top: 1px solid var(--border-glass); padding-top: 10px; margin-top: 10px;">
                                💡 当日反思：<span id="hist-reflection"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Fullscreen Modal -->
    <div id="mindmap-modal">
        <div class="modal-content">
            <div class="modal-close">&times;</div>
            <iframe id="modal-iframe" src="" style="width:100%; height:100%; border:none;"></iframe>
        </div>
    </div>

    <!-- Cache Buster for JS -->
    <script>
        const v = new Date().getTime();
        document.write('<script src="data.js?v=' + v + '"><\/script>');
        document.write('<script src="script.js?v=' + v + '"><\/script>');
    </script>
</body>
</html>
